

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started: RAM Report Data &mdash; Ramutils 2.3.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Serializable data structures" href="data.html" />
    <link rel="prev" title="ramutils" href="index.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Ramutils
          

          
          </a>

          
            
            
              <div class="version">
                2.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started: RAM Report Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Finding-Data">Finding Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Loading-Multiple-Files-of-a-Single-Type">Loading Multiple Files of a Single Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Extracting-Metadata-from-the-File-Path">Extracting Metadata from the File Path</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Building-an-Item-Level-Dataset">Building an Item-Level Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Reloading-a-Trained-Classifier">Reloading a Trained Classifier</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Pandas-Magic">Pandas Magic</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Combining-Across-Summary-File-Types">Combining Across Summary File Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Aggregating-to-a-different-level">Aggregating to a different level</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Serializable data structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="classifier.html">Classifier training, cross validation, and utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Event processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command-line usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Miscellaneous utilities</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ramutils</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Getting Started: RAM Report Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/getting_started_report_data.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="Getting-Started:-RAM-Report-Data">
<h1>Getting Started: RAM Report Data<a class="headerlink" href="#Getting-Started:-RAM-Report-Data" title="Permalink to this headline">¶</a></h1>
<p>In the process of generating reports for both record-only and
stimulation sessions, the RAM reporting pipeline produces a number of
summary data files. These files contain all of the information requried
to reproduce the plots, summary statistics, and any analyses contained
in the reports. However, another use for these summary files is for
conducting alternative post-hoc analyses using the RAM data. In
particular, some common use cases for this data are:</p>
<ol class="arabic simple">
<li>Post-hoc assessment of classifier performance and/or re-assessment
using a different classifier</li>
<li>Behavioral analyses comparing cohorts of subjects or comparing
stim/no-stim experimental conditions</li>
<li>High-level summary information (either behavioral or
electrophysiological) across a broad group of subjects</li>
</ol>
<p><strong>Data Types</strong></p>
<p>Each of the summary files saved as part of generating a report has a
corresponding python class with various properties and helper methods
defined. These classes are documented in the <a class="reference external" href="https://pennmem.github.io/ram_utils/html/data.html">Seraializeable Data
Structures</a>
section of the ramutils documentation.</p>
<ol class="arabic simple">
<li>Session Summary</li>
<li>Math Summary</li>
<li>Classifier Summary</li>
<li>Target Selection Table</li>
<li>Retrained Classifier</li>
</ol>
<p><strong>Common Patterns</strong></p>
<p>The remainder of this guide will go through some common usage patterns
for interacting with the saved data including:</p>
<ol class="arabic simple">
<li>Finding data</li>
<li>Loading multiple files of a single type</li>
<li>Extracting metadata from a file path</li>
<li>Building an item-level dataset</li>
<li>Reloading a trained classifier</li>
<li>Pandas magic</li>
<li>Combining across summary file types</li>
</ol>
<div class="section" id="Finding-Data">
<h2>Finding Data<a class="headerlink" href="#Finding-Data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>from ramutils.tasks.misc import load_existing_results
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Could not import MorletWaveletFilterCppLegacy (single-core C++ version of MorletWaveletFilter): cannot import name &#39;MorletWaveletTransform&#39;
You can still use MorletWaveletFilter
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>rhino_root = &#39;/Volumes/RHINO/&#39;
report_db_location = &quot;/Volumes/RHINO/scratch/report_database/&quot;
</pre></div>
</div>
</div>
<p>For loading all saved data associated with a single subject/experiment
combination (either a single session or multiple sessions), you can use
the load_existing_results helper function. Internally, this function is
used to load data for producing aggregate reports. A dictionary is
returned whose keys indicate the type of underlying data. The values are
a list of the summary objects, one per session. For this example, we are
loading a single session.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># .compute() is required because load_existing_results is actual a task, which
# is lazily evaluated by default
results_dict = load_existing_results(subject=&#39;R1389J&#39;, experiment=&#39;catFR5&#39;,
                                     sessions=[1], stim_report=True,
                                     db_loc=report_db_location, rootdir=rhino_root).compute()
list(results_dict.keys())
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
[I 2018-05-16 15:11:47,221 _wrapper.py:21] calling load_existing_results
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[3]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[&#39;target_selection_table&#39;,
 &#39;classifier_evaluation_results&#39;,
 &#39;session_summaries&#39;,
 &#39;math_summaries&#39;,
 &#39;hmm_results&#39;]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>classifier_data = results_dict[&#39;classifier_evaluation_results&#39;][0]
print(&quot;Data is saved as a {} object.\nAUC for this session: {}&quot;.format(type(classifier_data), classifier_data.auc))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data is saved as a &lt;class &#39;ramutils.reports.summary.ClassifierSummary&#39;&gt; object.
AUC for this session: 0.6512345679012346
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>session_data = results_dict[&#39;session_summaries&#39;][0]
print(&quot;Data is saved as a {} object.\nSession Completed On: {}&quot;.format(type(session_data),
                                                                       session_data.session_datetime))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data is saved as a &lt;class &#39;ramutils.reports.summary.FRStimSessionSummary&#39;&gt; object.
Session Completed On: 2018-02-28 16:47:02.190000+00:00
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>math_data = results_dict[&#39;math_summaries&#39;][0]
print(&quot;Data is saved as a {} object.\nSubject answer {}% math problems correctly&quot;.format(type(math_data),
                                                                                          math_data.percent_correct))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data is saved as a &lt;class &#39;ramutils.reports.summary.MathSummary&#39;&gt; object.
Subject answer 79.76190476190476% math problems correctly
</pre></div></div>
</div>
</div>
<div class="section" id="Loading-Multiple-Files-of-a-Single-Type">
<h2>Loading Multiple Files of a Single Type<a class="headerlink" href="#Loading-Multiple-Files-of-a-Single-Type" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import os
import glob

from ramutils.reports.summary import FRStimSessionSummary

fr5_session_summary_locations = glob.glob(os.path.join(report_db_location, &#39;*FR5*session_summary*&#39;))
print(&quot;Found {} FR5 or catFR5 session summaries&quot;.format(len(fr5_session_summary_locations)))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found 58 FR5 or catFR5 session summaries
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>session_summaries = []
for summary_loc in fr5_session_summary_locations:
    summary = FRStimSessionSummary.from_hdf(summary_loc)
    session_summaries.append(summary)
</pre></div>
</div>
</div>
</div>
<div class="section" id="Extracting-Metadata-from-the-File-Path">
<h2>Extracting Metadata from the File Path<a class="headerlink" href="#Extracting-Metadata-from-the-File-Path" title="Permalink to this headline">¶</a></h2>
<p>As noted in the documentation, underlying files are stored with a
specific naming convention so that they can be easily differentiated
despite residing in the same directory. ramutils has a utility function
for extracting this metadata from the file path, which can be handy when
combining multiple files of a single type or across types</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>from ramutils.utils import extract_report_info_from_path

metadata = extract_report_info_from_path(fr5_session_summary_locations[0])
metadata
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[9]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;subject&#39;: &#39;R1275D&#39;,
 &#39;experiment&#39;: &#39;FR5&#39;,
 &#39;montage&#39;: 0,
 &#39;sessions&#39;: [1],
 &#39;file_name&#39;: &#39;session_summary&#39;,
 &#39;file_type&#39;: &#39;h5&#39;}
</pre></div>
</div>
</div>
</div>
<div class="section" id="Building-an-Item-Level-Dataset">
<h2>Building an Item-Level Dataset<a class="headerlink" href="#Building-an-Item-Level-Dataset" title="Permalink to this headline">¶</a></h2>
<p>One of the properties of the session summary objects is a dataframe
containing all of the encoding events from the session that has been
enriched with stimulation parameter information and other metadata in
the case of a stimulation session. One common use case is to perform
some sort of behavioral analysis that requires item-level information.
Oftentimes, this analysis is done across subjects and experiments.
Luckily, there is a helper method to make it rather trivial to combine
this item-level information and return a Pandas Dataframe</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>combined_item_df = FRStimSessionSummary.combine_sessions(session_summaries)
combined_item_df.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>serialpos</th>
      <th>session</th>
      <th>subject</th>
      <th>experiment</th>
      <th>mstime</th>
      <th>type</th>
      <th>recalled</th>
      <th>list</th>
      <th>is_stim_list</th>
      <th>phase</th>
      <th>...</th>
      <th>is_stim_item</th>
      <th>is_post_stim_item</th>
      <th>thresh</th>
      <th>classifier_output</th>
      <th>location</th>
      <th>amplitude</th>
      <th>pulse_freq</th>
      <th>stim_duration</th>
      <th>stimAnodeTag</th>
      <th>stimCathodeTag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>R1275D</td>
      <td>FR5</td>
      <td>1497112517408</td>
      <td>WORD</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>BASELINE</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0.5</td>
      <td>0.565596</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>R1275D</td>
      <td>FR5</td>
      <td>1497112520131</td>
      <td>WORD</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>BASELINE</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0.5</td>
      <td>0.647678</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>R1275D</td>
      <td>FR5</td>
      <td>1497112522816</td>
      <td>WORD</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>BASELINE</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0.5</td>
      <td>0.358846</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1</td>
      <td>R1275D</td>
      <td>FR5</td>
      <td>1497112525335</td>
      <td>WORD</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>BASELINE</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0.5</td>
      <td>0.459033</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1</td>
      <td>R1275D</td>
      <td>FR5</td>
      <td>1497112527751</td>
      <td>WORD</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>BASELINE</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0.5</td>
      <td>0.446794</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div></div>
</div>
<p>We previously found 58 sessions worth of data. At 300 encoding events
per session, we should have around 17,400 rows in our dataset, unless
some sessions were incomplete</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>len(combined_item_df)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[11]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>16548
</pre></div>
</div>
</div>
</div>
<div class="section" id="Reloading-a-Trained-Classifier">
<h2>Reloading a Trained Classifier<a class="headerlink" href="#Reloading-a-Trained-Classifier" title="Permalink to this headline">¶</a></h2>
<p>Another useful set of information is the classifier itself, rather than
just the classifier evaluation results. There are two ways to get this
data. The best way is to load the classifier that was actually used
during the session. Ramutils has a helpfer function to do this loading
for you. The benefit of using this classifier is that it should allow
you to exactly match what occured during the session, since this is the
classifier that Ramulator was using. If channels were excluded because
of some artifact detection routine(s), there will be no need to deal
with this post-hoc. Unfortunately, having a consistent storage format is
a relatively recent development, so for older subjects it will not be
possible to load the actual classifier used. Instead, you can use the
classifier trained with the default parameters (frequencies, timings,
etc.) that is saved to the report database directory.</p>
<p>You can find more information about the storage format of the classifier
by looking at the
<a class="reference external" href="https://pennmem.github.io/classiflib/html/index.html">documentation</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Reloading the used classifier
from ramutils.classifier.utils import reload_classifier

classifier_container = reload_classifier(&#39;R1387E&#39;, &#39;catFR5&#39;, 1, mount_point=&#39;/Volumes/RHINO/&#39;)
classifier_container.features.shape # n_events x n_features power matrix
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[12]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(997, 872)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Loading the classifier from the reports database
from classiflib.container import ClassifierContainer

retrained_classifier_loc = glob.glob(os.path.join(report_db_location, &#39;R1387E_catFR5_all_retrained_classifier*&#39;))[0]
classifier_container = ClassifierContainer.load(retrained_classifier_loc)
classifier_container.features.shape
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[13]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(997, 968)
</pre></div>
</div>
</div>
<p>In this case, we can see that the classifier used during the session
differs from the one that does not take into account artifactual
channels. In fact, we can deduce that 12 channels were exclude due to
artifact detection (12 * 8 = 968 - 972).</p>
<p>Once a classifier has been loaded, the main use cases are to make out of
sample predictions and check on the AUC from the training session.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import numpy as np
import seaborn as sns

%matplotlib inline

classifier = classifier_container.classifier

print(&quot;Training AUC: {:.2f}&quot;.format(classifier_container.classifier_info[&#39;auc&#39;]))

# Create 100 random new events and calculated predicted probabilities
out_of_sample_powers = np.random.normal(size=(100, classifier_container.features.shape[1]))
predicted_probs = classifier.predict_proba(out_of_sample_powers)[:, 1]
sns.distplot(predicted_probs)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Training AUC: 0.61
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/zduey/miniconda3/envs/ramutils_dev/envs/ramutils_test/lib/python3.6/site-packages/matplotlib/axes/_axes.py:6462: UserWarning: The &#39;normed&#39; kwarg is deprecated, and has been replaced by the &#39;density&#39; kwarg.
  warnings.warn(&#34;The &#39;normed&#39; kwarg is deprecated, and has been &#34;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[14]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1c76ae7400&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/getting_started_report_data_22_3.png" src="_images/getting_started_report_data_22_3.png" />
</div>
</div>
</div>
<div class="section" id="Pandas-Magic">
<h2>Pandas Magic<a class="headerlink" href="#Pandas-Magic" title="Permalink to this headline">¶</a></h2>
<p>One pattern that has come in handy for almost every cross-subject
analysis, is the ability to embed these summary objects in a pandas
dataframe. Bear with me as this sounds strange, but what it allows you
to do is to write your own functions that operate on a summary object
and return some information. These functions can then make use of the
pandas API to quickly apply the transformation to all session summaries
in a series. In this way, you can easily extend the built-in set of
methods that operate on these summary objects. Let’s go through a quick
example.</p>
<p>First, we will define some custom function that takes a summary object
as its input. In this case, we have some behavioral measure of recall
performance that we want to calculate that is not part of the standard
set of methods.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>def normalized_item_delta_recall(summary):
    &quot;&quot;&quot; Calculate normalized delta recall at the item level

    Parameters
    ----------
    summary: ramutils.reports.summary.FRStimSessionSummary
        Helper class containing events, powers, montage, and other information needed to analyze a single
        stimulation session

    Returns
    -------
    normalized_delta_recall: float
        Item-level measure of the change in recall performance due to stimulation. Calculated by
        comparing the recall rates for stimulated items with items for non-stim lists that would
        have been stimulated

    &quot;&quot;&quot;
    if type(summary) != list:
        summary = [summary]
    df = FRStimSessionSummary.combine_sessions(summary)
    nonstim_low_bio_recall = df[(df.classifier_output &lt; df.thresh) &amp;
                                (df.is_stim_list == False)].recalled.mean()
    stim_recall = df[df.is_stim_item == True].recalled.mean()
    overall_recall = df.recalled.mean()
    normalized_delta_recall = 100 * ((stim_recall - nonstim_low_bio_recall) / overall_recall)
    return normalized_delta_recall
</pre></div>
</div>
</div>
<p>Next, we will calculate normalized item-level delta recall using two
different methods. This first method uses list comprehension, and the
second uses the session summary objects embedded in a pandas dataframe.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>normalized_delta_recall = [normalized_item_delta_recall(summary) for summary in session_summaries]
</pre></div>
</div>
</div>
<p>Ok, so great. Now we have this list of values that we wanted to extract.
We can do some simple things with it:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(&quot;Average item-level delta recall: {:.2f}%&quot;.format(np.nanmean(np.array(normalized_delta_recall))))
print(&quot;Biggest item-level delta recall: {:.2f}%&quot;.format(max(normalized_delta_recall)))
print(&quot;Biggest adverse item-level delta recall: {:.2f}%&quot;.format(min(normalized_delta_recall)))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Average item-level delta recall: 4.24%
Biggest item-level delta recall: 87.69%
Biggest adverse item-level delta recall: -60.29%
</pre></div></div>
</div>
<p>This works pretty well for doing some basic manipulations and even
plotting, but what if we want to ask some slightly less trivial
questions? For example, what is the mean, min, max delta recall split by
FR5/catFR5? What if we want to split based on stimulation region or some
other value? This is no longer straightforward to do with the list-based
method. Instead, let’s get these summary objects into a pandas dataframe
and really let the analyses run wild.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import pandas as pd

session_data = {
    &#39;subject&#39;: [],
    &#39;experiment&#39;: [],
    &#39;session&#39;: [],
    &#39;session_summary&#39;: [],
    &#39;montage&#39;: [],
    &#39;anode&#39;: [],
    &#39;cathode&#39;: [],
    &#39;electrode_type&#39;: [],
    &#39;location&#39;: [],
    &#39;amplitude&#39;: [],
    &#39;pulse_freq&#39;: [],
    &#39;stim_duration&#39;: [],
    &#39;date&#39;: []
}

for session_summary_loc in fr5_session_summary_locations:
    metadata = extract_report_info_from_path(session_summary_loc)
    session_summary = FRStimSessionSummary.from_hdf(session_summary_loc)
    session_df = pd.DataFrame.from_records(session_summary._events)
    stim_params = FRStimSessionSummary.stim_parameters([session_summary])[0]

    session_data[&#39;subject&#39;].append(metadata[&#39;subject&#39;])
    session_data[&#39;experiment&#39;].append(metadata[&#39;experiment&#39;])
    session_data[&#39;session&#39;].append(metadata[&#39;sessions&#39;][0])
    session_data[&#39;session_summary&#39;].append(session_summary)
    session_data[&#39;montage&#39;].append(metadata[&#39;montage&#39;])
    session_data[&#39;anode&#39;].append(stim_params[&#39;stimAnodeTag&#39;])
    session_data[&#39;cathode&#39;].append(stim_params[&#39;stimCathodeTag&#39;])
    session_data[&#39;electrode_type&#39;].append(&#39;&#39;)
    session_data[&#39;location&#39;].append(stim_params[&#39;location&#39;])
    session_data[&#39;amplitude&#39;].append(float(stim_params[&#39;amplitude&#39;]))
    session_data[&#39;pulse_freq&#39;].append(float(stim_params[&#39;pulse_freq&#39;]))
    session_data[&#39;stim_duration&#39;].append(float(stim_params[&#39;stim_duration&#39;]))
    session_data[&#39;date&#39;].append(session_summary.session_datetime)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>session_df = pd.DataFrame.from_dict(session_data)
session_df = session_df[[&#39;subject&#39;, &#39;experiment&#39;, &#39;montage&#39;, &#39;session&#39;,
                         &#39;date&#39;, &#39;session_summary&#39;, &#39;electrode_type&#39;, &#39;location&#39;,
                         &#39;pulse_freq&#39;, &#39;stim_duration&#39;]]
session_df.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject</th>
      <th>experiment</th>
      <th>montage</th>
      <th>session</th>
      <th>date</th>
      <th>session_summary</th>
      <th>electrode_type</th>
      <th>location</th>
      <th>pulse_freq</th>
      <th>stim_duration</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R1275D</td>
      <td>FR5</td>
      <td>0</td>
      <td>1</td>
      <td>2017-06-10 17:15:09.603000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 1, 'R1275...</td>
      <td></td>
      <td>Right Cerebral White Matter</td>
      <td>200.0</td>
      <td>500.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>R1275D</td>
      <td>FR5</td>
      <td>0</td>
      <td>2</td>
      <td>2017-06-11 17:29:07.115000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 2, 'R1275...</td>
      <td></td>
      <td>Right Cerebral White Matter</td>
      <td>200.0</td>
      <td>500.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R1292E</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>2017-07-03 16:12:42.221000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R1292...</td>
      <td></td>
      <td>Left Middle Temporal Gyrus</td>
      <td>100.0</td>
      <td>500.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R1304N</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>2017-05-29 15:35:00.879000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R1304...</td>
      <td></td>
      <td>Right Cerebral White Matter</td>
      <td>200.0</td>
      <td>500.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R1308T</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>2017-06-19 20:33:04.856000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R1308...</td>
      <td></td>
      <td>Left Middle Temporal Gyrus</td>
      <td>200.0</td>
      <td>500.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>So it was not as easy to generate as the list, but we ended with a nice
user-friend data structure that is going to open up a lot of doors for
doing our analyses that were previously much more complicated. Let’s
start by creating a new variable in the dataset to represent the
normalized item-level delta recall metric that we calculated before.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>session_df[&#39;delta_recall&#39;] = session_df[&#39;session_summary&#39;].apply(normalized_item_delta_recall)
session_df.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject</th>
      <th>experiment</th>
      <th>montage</th>
      <th>session</th>
      <th>date</th>
      <th>session_summary</th>
      <th>electrode_type</th>
      <th>location</th>
      <th>pulse_freq</th>
      <th>stim_duration</th>
      <th>delta_recall</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R1275D</td>
      <td>FR5</td>
      <td>0</td>
      <td>1</td>
      <td>2017-06-10 17:15:09.603000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 1, 'R1275...</td>
      <td></td>
      <td>Right Cerebral White Matter</td>
      <td>200.0</td>
      <td>500.0</td>
      <td>35.411540</td>
    </tr>
    <tr>
      <th>1</th>
      <td>R1275D</td>
      <td>FR5</td>
      <td>0</td>
      <td>2</td>
      <td>2017-06-11 17:29:07.115000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 2, 'R1275...</td>
      <td></td>
      <td>Right Cerebral White Matter</td>
      <td>200.0</td>
      <td>500.0</td>
      <td>-7.532247</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R1292E</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>2017-07-03 16:12:42.221000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R1292...</td>
      <td></td>
      <td>Left Middle Temporal Gyrus</td>
      <td>100.0</td>
      <td>500.0</td>
      <td>5.376644</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R1304N</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>2017-05-29 15:35:00.879000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R1304...</td>
      <td></td>
      <td>Right Cerebral White Matter</td>
      <td>200.0</td>
      <td>500.0</td>
      <td>55.067482</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R1308T</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>2017-06-19 20:33:04.856000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R1308...</td>
      <td></td>
      <td>Left Middle Temporal Gyrus</td>
      <td>200.0</td>
      <td>500.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>If that doesn’t get you excited, then I don’t know what will and you may
as well stop reading this tutorial. For the sake of completeness, let’s
replicate what we did before… and more…</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(&quot;Average item-level delta recall: {:.2f}%&quot;.format(session_df[&#39;delta_recall&#39;].mean()))
print(&quot;Biggest item-level delta recall: {:.2f}%&quot;.format(session_df[&#39;delta_recall&#39;].max()))
print(&quot;Biggest adverse item-level delta recall: {:.2f}%&quot;.format(session_df[&#39;delta_recall&#39;].min()))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Average item-level delta recall: 4.24%
Biggest item-level delta recall: 87.69%
Biggest adverse item-level delta recall: -60.29%
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>session_df.groupby(by=&#39;experiment&#39;).agg({&#39;delta_recall&#39;: [&#39;mean&#39;, &#39;min&#39;, &#39;max&#39;]})
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">delta_recall</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>min</th>
      <th>max</th>
    </tr>
    <tr>
      <th>experiment</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>FR5</th>
      <td>3.739698</td>
      <td>-60.293627</td>
      <td>87.689632</td>
    </tr>
    <tr>
      <th>catFR5</th>
      <td>4.622367</td>
      <td>-39.462656</td>
      <td>61.873683</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>session_df.groupby(by=&#39;location&#39;).agg({&#39;delta_recall&#39;: [&#39;mean&#39;, &#39;min&#39;, &#39;max&#39;]})
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">delta_recall</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>min</th>
      <th>max</th>
    </tr>
    <tr>
      <th>location</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>--</th>
      <td>-12.920880</td>
      <td>-23.027612</td>
      <td>-0.691512</td>
    </tr>
    <tr>
      <th>Left Cerebral White Matter</th>
      <td>-28.169914</td>
      <td>-28.169914</td>
      <td>-28.169914</td>
    </tr>
    <tr>
      <th>Left Middle Temporal Gyrus</th>
      <td>10.327724</td>
      <td>-36.400404</td>
      <td>87.689632</td>
    </tr>
    <tr>
      <th>Left caudalmiddlefrontal</th>
      <td>-26.389477</td>
      <td>-35.246487</td>
      <td>-17.532468</td>
    </tr>
    <tr>
      <th>Left inferiortemporal</th>
      <td>29.324192</td>
      <td>29.324192</td>
      <td>29.324192</td>
    </tr>
    <tr>
      <th>Left middletemporal</th>
      <td>6.031860</td>
      <td>-39.462656</td>
      <td>61.873683</td>
    </tr>
    <tr>
      <th>Left precentral</th>
      <td>6.639869</td>
      <td>6.639869</td>
      <td>6.639869</td>
    </tr>
    <tr>
      <th>Left rostralmiddlefrontal</th>
      <td>1.668592</td>
      <td>1.668592</td>
      <td>1.668592</td>
    </tr>
    <tr>
      <th>Right Cerebral White Matter</th>
      <td>5.663287</td>
      <td>-60.293627</td>
      <td>55.067482</td>
    </tr>
    <tr>
      <th>Right MCg</th>
      <td>2.332751</td>
      <td>-4.132304</td>
      <td>8.797806</td>
    </tr>
    <tr>
      <th>Right Middle Temporal Gyrus</th>
      <td>16.338604</td>
      <td>-45.993947</td>
      <td>78.671155</td>
    </tr>
    <tr>
      <th>Right caudalmiddlefrontal</th>
      <td>11.732229</td>
      <td>11.732229</td>
      <td>11.732229</td>
    </tr>
    <tr>
      <th>Right middletemporal</th>
      <td>-3.304355</td>
      <td>-28.242959</td>
      <td>21.634249</td>
    </tr>
    <tr>
      <th>Right parstriangularis</th>
      <td>12.677112</td>
      <td>-3.591954</td>
      <td>28.946178</td>
    </tr>
    <tr>
      <th>Right rostralmiddlefrontal</th>
      <td>13.461996</td>
      <td>5.021732</td>
      <td>22.924525</td>
    </tr>
    <tr>
      <th>Right superiorfrontal</th>
      <td>-4.072398</td>
      <td>-4.072398</td>
      <td>-4.072398</td>
    </tr>
    <tr>
      <th>Right superiortemporal</th>
      <td>-8.582085</td>
      <td>-12.624835</td>
      <td>-1.666667</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We just answered the two questions we posed previously in one line of
code of each. Try doing that with a recarray all you doubters out there.</p>
</div>
<div class="section" id="Combining-Across-Summary-File-Types">
<h2>Combining Across Summary File Types<a class="headerlink" href="#Combining-Across-Summary-File-Types" title="Permalink to this headline">¶</a></h2>
<p>So far, we have been taking a look at the data contained in each of
these summary objects in isolation. However, for many analyses, you may
want to combine the information contained in each. For example, the most
commone usage pattern is to combine information about the trained
classifier, the classifier results from the session, and the session
summary data. The three of those together open up a world of
possibilities for your analyses. To do this, we are going to generalize
the “Pandas magic” approach by creating a dataframe containing the
summary object of interest and then rely on the merging mechanics
available through pandas to get all of this data into a single data
structure.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>from ramutils.reports.summary import ClassifierSummary

# Repeat the process for getting summary objects into a dataframe that we used for the session summaries
classifier_summaries = glob.glob(os.path.join(report_db_location, &#39;*FR5*classifier_session*&#39;))

classifier_summary_data = {
    &#39;subject&#39;: [],
    &#39;experiment&#39;: [],
    &#39;session&#39;: [],
    &#39;classifier_summary&#39;: [],
    &#39;montage&#39;: [],
    &#39;auc&#39;: [],
    &#39;pvalue&#39;: []
}

for summary_dir in classifier_summaries:
    summary = ClassifierSummary.from_hdf(summary_dir)
    metadata = extract_report_info_from_path(summary_dir)
    classifier_summary_data[&#39;subject&#39;].append(metadata[&#39;subject&#39;])
    classifier_summary_data[&#39;experiment&#39;].append(metadata[&#39;experiment&#39;])
    classifier_summary_data[&#39;session&#39;].append(metadata[&#39;sessions&#39;][0])
    classifier_summary_data[&#39;classifier_summary&#39;].append(summary)
    classifier_summary_data[&#39;montage&#39;].append(metadata[&#39;montage&#39;])
    classifier_summary_data[&#39;auc&#39;].append(summary.auc)
    classifier_summary_data[&#39;pvalue&#39;].append(summary.pvalue)

classifier_df = pd.DataFrame.from_dict(classifier_summary_data)
classifier_df = classifier_df[[&#39;subject&#39;, &#39;experiment&#39;, &#39;montage&#39;, &#39;session&#39;,
                               &#39;classifier_summary&#39;, &#39;pvalue&#39;, &#39;auc&#39;]]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>classifier_df.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject</th>
      <th>experiment</th>
      <th>montage</th>
      <th>session</th>
      <th>classifier_summary</th>
      <th>pvalue</th>
      <th>auc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R1275D</td>
      <td>FR5</td>
      <td>0</td>
      <td>1</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.015</td>
      <td>0.616795</td>
    </tr>
    <tr>
      <th>1</th>
      <td>R1275D</td>
      <td>FR5</td>
      <td>0</td>
      <td>2</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.410</td>
      <td>0.515080</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R1292E</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.390</td>
      <td>0.515818</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R1304N</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.315</td>
      <td>0.526984</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R1308T</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.000</td>
      <td>0.705267</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>You will notice that there is information duplicated across the
classifier dataframe and the session summary dataframe. This is
intentional, as we need it in order to merge the two. Let’s do that now.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>combined_df = session_df.merge(classifier_df, how=&#39;left&#39;)
combined_df.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject</th>
      <th>experiment</th>
      <th>montage</th>
      <th>session</th>
      <th>date</th>
      <th>session_summary</th>
      <th>electrode_type</th>
      <th>location</th>
      <th>pulse_freq</th>
      <th>stim_duration</th>
      <th>delta_recall</th>
      <th>classifier_summary</th>
      <th>pvalue</th>
      <th>auc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R1275D</td>
      <td>FR5</td>
      <td>0</td>
      <td>1</td>
      <td>2017-06-10 17:15:09.603000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 1, 'R1275...</td>
      <td></td>
      <td>Right Cerebral White Matter</td>
      <td>200.0</td>
      <td>500.0</td>
      <td>35.411540</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.015</td>
      <td>0.616795</td>
    </tr>
    <tr>
      <th>1</th>
      <td>R1275D</td>
      <td>FR5</td>
      <td>0</td>
      <td>2</td>
      <td>2017-06-11 17:29:07.115000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 2, 'R1275...</td>
      <td></td>
      <td>Right Cerebral White Matter</td>
      <td>200.0</td>
      <td>500.0</td>
      <td>-7.532247</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.410</td>
      <td>0.515080</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R1292E</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>2017-07-03 16:12:42.221000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R1292...</td>
      <td></td>
      <td>Left Middle Temporal Gyrus</td>
      <td>100.0</td>
      <td>500.0</td>
      <td>5.376644</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.390</td>
      <td>0.515818</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R1304N</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>2017-05-29 15:35:00.879000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R1304...</td>
      <td></td>
      <td>Right Cerebral White Matter</td>
      <td>200.0</td>
      <td>500.0</td>
      <td>55.067482</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.315</td>
      <td>0.526984</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R1308T</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>2017-06-19 20:33:04.856000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R1308...</td>
      <td></td>
      <td>Left Middle Temporal Gyrus</td>
      <td>200.0</td>
      <td>500.0</td>
      <td>NaN</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.000</td>
      <td>0.705267</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Since this is a 1:1 merge, our expectation is that the number of rows
should not have changed and that we should have a classifier summary
corresponding to each session summary. In general, it is a good idea to
check these assumptions before proceeding with any anlayses.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>assert len(combined_df) == len(session_df) == len(classifier_df)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Check if we are missing any classifier summaries
combined_df[combined_df[&#39;classifier_summary&#39;].isnull() == True]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject</th>
      <th>experiment</th>
      <th>montage</th>
      <th>session</th>
      <th>date</th>
      <th>session_summary</th>
      <th>electrode_type</th>
      <th>location</th>
      <th>pulse_freq</th>
      <th>stim_duration</th>
      <th>delta_recall</th>
      <th>classifier_summary</th>
      <th>pvalue</th>
      <th>auc</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div>
</div>
<p>With the classifier information joined with the session information, we
can now ask a wider set of question. For example, how does classifier
performance correlated with delta recall?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>sns.jointplot(x=&#39;auc&#39;,
              y=&#39;delta_recall&#39;,
              kind=&quot;reg&quot;,
              data=combined_df)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/zduey/miniconda3/envs/ramutils_dev/envs/ramutils_test/lib/python3.6/site-packages/matplotlib/axes/_axes.py:6462: UserWarning: The &#39;normed&#39; kwarg is deprecated, and has been replaced by the &#39;density&#39; kwarg.
  warnings.warn(&#34;The &#39;normed&#39; kwarg is deprecated, and has been &#34;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[29]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;seaborn.axisgrid.JointGrid at 0x1cb803f7b8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/getting_started_report_data_48_2.png" src="_images/getting_started_report_data_48_2.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Trained Classifier Dataset
import classiflib

retrained_classifiers = glob.glob(os.path.join(report_db_location, &#39;*retrained_classifier*&#39;))
training_classifier_summary_data = {
    &#39;subject&#39;: [],
    &#39;montage&#39;: [],
    &#39;training_auc&#39;: [],
    &#39;classifier&#39;: []
}
for classifier_loc in retrained_classifiers:
    metadata = extract_report_info_from_path(classifier_loc)
    subject = metadata[&#39;subject&#39;]
    montage = metadata[&#39;montage&#39;]

    # Only add the retrained classifier if one has not already been added
    # for the given subject
    if subject not in training_classifier_summary_data[&#39;subject&#39;]:
        classifier = classiflib.container.ClassifierContainer.load(classifier_loc)
        training_classifier_summary_data[&#39;training_auc&#39;].append(classifier.classifier_info[&#39;auc&#39;])
        training_classifier_summary_data[&#39;subject&#39;].append(subject)
        training_classifier_summary_data[&#39;montage&#39;].append(montage)
        training_classifier_summary_data[&#39;classifier&#39;].append(classifier)

trained_classifier_df = pd.DataFrame.from_dict(training_classifier_summary_data)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>combined_df = combined_df.merge(trained_classifier_df, how=&#39;left&#39;)
</pre></div>
</div>
</div>
<p>Let’s again check that the merge has worked as expected</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>assert len(combined_df) == len(session_df)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>combined_df[combined_df[&#39;classifier&#39;].isnull() == True]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject</th>
      <th>experiment</th>
      <th>montage</th>
      <th>session</th>
      <th>date</th>
      <th>session_summary</th>
      <th>electrode_type</th>
      <th>location</th>
      <th>pulse_freq</th>
      <th>stim_duration</th>
      <th>delta_recall</th>
      <th>classifier_summary</th>
      <th>pvalue</th>
      <th>auc</th>
      <th>classifier</th>
      <th>training_auc</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>combined_df.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject</th>
      <th>experiment</th>
      <th>montage</th>
      <th>session</th>
      <th>date</th>
      <th>session_summary</th>
      <th>electrode_type</th>
      <th>location</th>
      <th>pulse_freq</th>
      <th>stim_duration</th>
      <th>delta_recall</th>
      <th>classifier_summary</th>
      <th>pvalue</th>
      <th>auc</th>
      <th>classifier</th>
      <th>training_auc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R1275D</td>
      <td>FR5</td>
      <td>0</td>
      <td>1</td>
      <td>2017-06-10 17:15:09.603000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 1, 'R1275...</td>
      <td></td>
      <td>Right Cerebral White Matter</td>
      <td>200.0</td>
      <td>500.0</td>
      <td>35.411540</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.015</td>
      <td>0.616795</td>
      <td>&lt;classiflib.container.ClassifierContainer obje...</td>
      <td>0.716635</td>
    </tr>
    <tr>
      <th>1</th>
      <td>R1275D</td>
      <td>FR5</td>
      <td>0</td>
      <td>2</td>
      <td>2017-06-11 17:29:07.115000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 2, 'R1275...</td>
      <td></td>
      <td>Right Cerebral White Matter</td>
      <td>200.0</td>
      <td>500.0</td>
      <td>-7.532247</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.410</td>
      <td>0.515080</td>
      <td>&lt;classiflib.container.ClassifierContainer obje...</td>
      <td>0.716635</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R1292E</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>2017-07-03 16:12:42.221000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R1292...</td>
      <td></td>
      <td>Left Middle Temporal Gyrus</td>
      <td>100.0</td>
      <td>500.0</td>
      <td>5.376644</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.390</td>
      <td>0.515818</td>
      <td>&lt;classiflib.container.ClassifierContainer obje...</td>
      <td>0.558089</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R1304N</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>2017-05-29 15:35:00.879000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R1304...</td>
      <td></td>
      <td>Right Cerebral White Matter</td>
      <td>200.0</td>
      <td>500.0</td>
      <td>55.067482</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.315</td>
      <td>0.526984</td>
      <td>&lt;classiflib.container.ClassifierContainer obje...</td>
      <td>0.503983</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R1308T</td>
      <td>FR5</td>
      <td>0</td>
      <td>0</td>
      <td>2017-06-19 20:33:04.856000+00:00</td>
      <td>&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R1308...</td>
      <td></td>
      <td>Left Middle Temporal Gyrus</td>
      <td>200.0</td>
      <td>500.0</td>
      <td>NaN</td>
      <td>&lt;ClassifierSummary(_predicted_probabilities=[ ...</td>
      <td>0.000</td>
      <td>0.705267</td>
      <td>&lt;classiflib.container.ClassifierContainer obje...</td>
      <td>0.599638</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>At this point, we have a dataset that contains some basic summary
information from each stim session, information about how the classifier
performed in the out of sample stim session, and information about the
trained classifier. These three pieces of information covers a wide
swath of potential analysis use cases.</p>
</div>
<div class="section" id="Aggregating-to-a-different-level">
<h2>Aggregating to a different level<a class="headerlink" href="#Aggregating-to-a-different-level" title="Permalink to this headline">¶</a></h2>
<p>One lingering concern is that we have so far implicitly assumed that our
analysis are based on information at the session level. In many case, we
may want to aggregate over sessions that a subject completed, aggregate
over all sessions in a particular experiment, or some other aggregation.
If we start with our standard session-level dataframe created using
pandas magic, this becomes rather trivial to do.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>subject_df = (session_df.groupby(by=[&#39;subject&#39;, &#39;experiment&#39;])
                        .agg({&#39;session_summary&#39;: lambda x: set(np.hstack(x.values)),
                              &#39;session&#39;: &#39;count&#39;,
                              &#39;delta_recall&#39;: &#39;mean&#39;})
                        .reset_index())
subject_df.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject</th>
      <th>experiment</th>
      <th>session_summary</th>
      <th>session</th>
      <th>delta_recall</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R1275D</td>
      <td>FR5</td>
      <td>{&lt;FRStimSessionSummary(_events=[ ( 1, 1, 'R127...</td>
      <td>2</td>
      <td>13.939646</td>
    </tr>
    <tr>
      <th>1</th>
      <td>R1292E</td>
      <td>FR5</td>
      <td>{&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R129...</td>
      <td>1</td>
      <td>5.376644</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R1304N</td>
      <td>FR5</td>
      <td>{&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R130...</td>
      <td>1</td>
      <td>55.067482</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R1308T</td>
      <td>FR5</td>
      <td>{&lt;FRStimSessionSummary(_events=[ ( 1, 2, 'R130...</td>
      <td>3</td>
      <td>10.134115</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R1315T</td>
      <td>FR5</td>
      <td>{&lt;FRStimSessionSummary(_events=[ ( 1, 0, 'R131...</td>
      <td>1</td>
      <td>-4.448695</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We now have a basic dataset that is at the subject level where our delta
recall measure that we have been interested is now the average across
sessions that the subject completed. The other nice thing that we’ve
done is that our session_summary field has not gone away, but rather, it
now contains the set of all session summary objects associated with the
sessions that the subject completed. This leaves us free to continue
writing functions that take a summary object or a list of summary
objects and returns some value of interest.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="data.html" class="btn btn-neutral float-right" title="Serializable data structures" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="ramutils" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>